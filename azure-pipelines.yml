# ASP.NET Core (.NET Framework)
# Build and test ASP.NET Core projects targeting the full .NET Framework.
# Add steps that publish symbols, save build artifacts, and more:
# https://docs.microsoft.com/azure/devops/pipelines/languages/dotnet-core

trigger:
- master

pool:
  name: 'windows-agent'

stages:
 - stage: Build_Stage
   jobs:
   - job: Build
     steps:
        - task: DotNetCoreCLI@2
          inputs:
            command: 'restore'
            projects: '*.sln'
            feedsToUse: 'select'

        - task: DotNetCoreCLI@2
          displayName: 'dotnet test'
          inputs:
            command: test
            projects:  '*.sln'
            arguments: ' --configuration Release --collect:"XPlat Code Coverage" '

        - task: PublishCodeCoverageResults@1
          displayName: 'Publish code coverage from $(Agent.TempDirectory)\**\coverage.cobertura.xml'
          inputs:
            codeCoverageTool: Cobertura
            summaryFileLocation: '$(Agent.TempDirectory)\**\coverage.cobertura.xml'

        - task: DotNetCoreCLI@2
          inputs:
            command: 'build'
            projects:  '*.sln'
            

        - task: DotNetCoreCLI@2
          displayName: 'dotnet publish'
          inputs:
            command: publish
            arguments: '--configuration Release --output $(build.artifactstagingdirectory)'
            zipAfterPublish: false


        - task: CopyFiles@2
          displayName: 'Copy Files to: $(build.artifactstagingdirectory)/ShoppingFrontend/'
          inputs:
            Contents: Dockerfile
            TargetFolder: '$(build.artifactstagingdirectory)/ShoppingFrontend/'

 
        - task: CopyFiles@2
          displayName: 'Copy Files to: $(build.artifactstagingdirectory)ShoppingFrontend//helmchart'
          inputs:
            SourceFolder: HelmChart
            TargetFolder: '$(build.artifactstagingdirectory)/ShoppingFrontend//HelmChart'

        - publish: $(Build.ArtifactStagingDirectory)
          artifact: drop